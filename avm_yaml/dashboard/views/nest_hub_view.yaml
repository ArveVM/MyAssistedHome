
title: "Nest Hub"
path: "nest_hub"
type: panel
# type: custom:masonry-layout
# layout:
#   width: 175
#   max_cols: 3

homeassistant:
  customize:
    package.node_anchors:
      temp1: &temp1 sensor.livingroom_netatmo_temperature
      tempout: &tempout sensor.outside_netatmo_temperature



cards:

  - type: vertical-stack
    cards:
      # #####  first a row of chips   ############################################################################################
      - type: custom:mushroom-chips-card
        alignment: center
        chips:
          - !include ../solutions/weather_chip.yaml
          # - type: weather
          #   entity: weather.forecast_mylocation
          #   show_conditions: false
          #   show_temperature: true
          #   tap_action:
          #     action: fire-dom-event
          #     browser_mod:
          #       service: browser_mod.popup
          #       data:
          #         content:
          #           type: vertical-stack
          #           cards:
          #             - !include ../solutions/weather_card.yaml


          # - type: weather
          #   entity: weather.mylocation
          #   show_conditions: false
          #   show_temperature: true
          #   tap_action:
          #     action: fire-dom-event
          #     browser_mod:
          #       service: browser_mod.popup
          #       data:
          #         content:
          #           type: vertical-stack
          #           cards:
          #             - !include ../solutions/weather_card.yaml
        
          - !include ../solutions/mail_chip.yaml
          
          - !include ../solutions/cpu_chip.yaml

          - !include ../area/house_light_chip.yaml
                                    
          - type: template
            entity: sensor.hotwater_soc
            content: >
              {{states(entity) | int }}%
            icon: mdi:thermometer-water
            icon_color: >
              {% set t=states(entity) | float(default=3) %}
              {% if t >= 40 %}
                white
              {% elif t >= 20 %}
                orange
              {% else %}
                red
              {% endif %}
            tap_action:
              action: fire-dom-event
              browser_mod:
                service: browser_mod.popup
                data:
                  content:
                    type: vertical-stack
                    cards:
                      - !include ../cards/hotwater_card.yaml

          - type: template
            entity: sensor.gullbilen_state_of_charge
            content: >
              {{states(entity) | float(default=61) | int }}%
            icon: mdi:car
            # icon_color: "{{ 'green' if is_state(entity, >= 50 ) else 'grey' }}"
            icon_color: >
              {% set t=states(entity) | float(default=61) %}
              {% if t >= 50 %}
                white
              {% elif t >= 35 %}
                orange
              {% else %}
                red
              {% endif %}
            tap_action:
              action: fire-dom-event
              browser_mod:
                service: browser_mod.popup
                data:
                  content:
                    type: vertical-stack
                    cards:
                      - !include ../cards/car_card.yaml

          - type: action
            icon: mdi:cctv
            tap_action:
              action: fire-dom-event
              browser_mod:
                service: browser_mod.popup
                data:
                  content:
                    type: vertical-stack
                    cards:
                      - !include ../solutions/camera_card.yaml
          - !include ../solutions/guest_wifi_chip.yaml

          - type: action
            icon: mdi:hammer
            tap_action:
              action: fire-dom-event
              browser_mod:
                service: browser_mod.popup
                data:
                  content:
                    type: vertical-stack
                    cards:
                      - !include ../solutions/ha_toolbox.yaml


      # #####  Then main   ############################################################################################
      - type: horizontal-stack
        cards:



          # #####  Then main  - LEFT SIDE  ############################################################################################
          - type: vertical-stack
            cards:

              # # ---------   POWER !!        -----------
              - !include ../solutions/pwrctrl_use_price_card3.yaml

              # # #####  Then main  - LEFT-left SIDE  ############################################################################################
              # - type: horizontal-stack
              #   cards:
              #     - type: vertical-stack
              #       cards:
              #         - !include ../solutions/pwrctrl_use_price_card31.yaml


              #         # # ----------  Calendar-row -----------        
              #         - type: vertical-stack
              #           cards:
              #             - type: custom:mushroom-template-card
              #               primary: Hello, {{user}}
              #               secondary: 7-days listing of calendar HA-shared,, click to refresh
              #               icon: mdi:home
              #               tap_action:
              #                 action: call-service
              #                 service: homeassistant.reload_config_entry
              #                 data: {}
              #                 target:
              #                   entity_id: calendar.ha_shared'

              - type: horizontal-stack
                cards:
                  # #####  Then main  - LEFT-LEFT SIDE  ############################################################################################
                  - type: vertical-stack
                    cards:
                      - !include ../solutions/pwrctrl_use_price_card31.yaml

                      - type: custom:mushroom-template-card
                        primary: Hello, {{user}}
                        secondary: 7-days listing of calendar HA-shared,, click to refresh
                        icon: mdi:home
                        tap_action:
                          action: call-service
                          service: homeassistant.reload_config_entry
                          data: {}
                          target:
                            entity_id: calendar.ha_shared'

                      - type: custom:mushroom-entity-card
                        entity: sensor.cert_expiry_timestamp_e220_duckdns_org
                        name: Certificate expiry date

                      - type: custom:auto-entities
                        card:
                          type: entities
                          title: Shellys unavailable
                          show_header_toggle: false
                        filter:
                          include:
                            # - integration: shelly 
                            - entity_id: switch.bathroom_heater_puck
                            - entity_id: switch.bathroom2_heater_puck
                            - entity_id: light.christmas_tree
                            - entity_id: switch.dishwasher_plug
                            - entity_id: switch.entry_heater_puck
                            - entity_id: switch.freezerdownstairs
                            - entity_id: switch.garage_dad
                            - entity_id: switch.garage_t
                            - entity_id: light.hallway_switch_up_2_2
                            - entity_id: switch.hotwater_puck
                            - entity_id: light.kidl_light_puck
                            - entity_id: light.kidm_lightbulb
                            - entity_id: switch.kitchen_heater
                            - entity_id: switch.kitchen_heatpump
                            - entity_id: switch.kitchen_switch1
                            - entity_id: switch.laundry_dryer_plug
                            - entity_id: switch.laundry_freezer
                            - entity_id: switch.laundry_heater_puck
                            - entity_id: light.laundry_lights_puck
                            - entity_id: switch.laundry_washer_puck
                            - entity_id: light.livingroom_lounge
                            - entity_id: light.livingroom_diningtable
                            - entity_id: light.loft      
                            - entity_id: switch.loft_heater_plug
                            - entity_id: switch.office_heater_plug
                            - entity_id: switch.server_rack_plug
                            - entity_id: switch.workshop_washer
                          exclude:
                            - state: "off"
                            - state: "on"
                            # - entity_category: sensors
                            # - entity_category: config
                            # - entity_category: diagnostics


                  # # #####  Then main  - LEFT-RIGHT SIDE  ############################################################################################
                  - type: custom:atomic-calendar-revive
                    entities:
                      - entity: calendar.ha_shared
                        name: HA-shared
                    firstDayOfWeek: 1
                    maxDaysToShow: 7
                    showWeekDay: true
                    refreshInterval: 60

              # # # ---------   Mental reminder, shold be in conditional with other "Alerts"        -----------
              # - type: custom:mushroom-entity-card
              #   entity: sensor.cert_expiry_timestamp_e220_duckdns_org
              #   name: Certificate expiry date
              # - type: custom:mushroom-entity-card
              #   entity: sensor.cert_expiry_timestamp_e220_duckdns_org
              #   name: Certificate expiry
              #   layout: vertical
              #   secondary_info: state

          # #####  Then main  - RIGHT SIDE  ############################################################################################
          - type: vertical-stack
            cards:
              # # ---------   Area-cards, swipe over two "pages"        -----------
              # - type: custom:swipe-card
              #   parameters:
              #   start_card: 1
              #   simulateTouch: true
              #   spaceBetween: 8
              #   preventInteractionOnTransition: true
              #   freeMode: true
              #   cards:

                  # Card/page1:
                  # - type: vertical-stack
                  #   cards:
                  #     # - type: custom:mushroom-template-card
                      #   primary: Hello, {{user}}
                      #   secondary: 7-days listing of calendar HA-shared,, click to refresh
                      #   icon: mdi:home
                      #   tap_action:
                      #     action: call-service
                      #     service: homeassistant.reload_config_entry
                      #     data: {}
                      #     target:
                      #       entity_id: calendar.ha_shared
                      # - type: custom:atomic-calendar-revive
                      #   entities:
                      #     - entity: calendar.ha_shared
                      #       name: HA-shared
                      #   firstDayOfWeek: 1
                      #   maxDaysToShow: 7
                      #   showWeekDay: true
                      #   refreshInterval: 60

                  # Card/page2:
                  - type: grid
                    columns: 3
                    square: false
                    cards:
                      - !include ../area/livingroom_area_card.yaml
                      - !include ../area/kitchen_area_card.yaml
                      - !include ../area/laundry_area_card.yaml

                      - !include ../area/bathroom_area_card.yaml
                      - !include ../area/loft_area_card.yaml
                      - !include ../area/hallway_area_card.yaml
                      
                      
                      - !include ../area/kidl_area_card.yaml
                      - !include ../area/kidm_area_card.yaml
                      - !include ../area/kids_area_card.yaml

                      - !include ../area/bathroom2_area_card.yaml
                      - !include ../area/office_area_card.yaml
                      - !include ../area/entry_area_card.yaml

                      - !include ../area/workshop_area_card.yaml
                      - !include ../area/serverroom_area_card.yaml
                      
                      - !include ../area/icehouse_area_card.yaml
                  #     - !include ../cards/blank_card.yaml

                      - !include ../area/garage_area_card.yaml
                      - !include ../area/outside_area_card.yaml
                      - !include ../area/bedroom_area_card.yaml


                  # Card/page3:
                  # - type: grid
                  #   columns: 2
                  #   square: false
                  #   cards:
                    
                  #     - !include ../area/office_area_card.yaml

                  #     - !include ../area/entry_area_card.yaml
                  #     - !include ../area/workshop_area_card.yaml

                      # - !include ../area/serverroom_area_card.yaml
                  #     - !include ../cards/blank_card.yaml
                      
