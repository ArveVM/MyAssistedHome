
title: "Nest Hub"
path: "nest_hub"
type: panel
# type: custom:masonry-layout
# layout:
#   width: 175
#   max_cols: 3

homeassistant:
  customize:
    package.node_anchors:
      temp1: &temp1 sensor.livingroom_netatmo_temperature
      tempout: &tempout sensor.outside_netatmo_temperature

cards:
  - type: horizontal-stack
    cards:
      - type: vertical-stack
        cards:
          # # ----------  Chips-row 0 -----------
          - type: custom:mushroom-chips-card
            alignment: justify
            chips:
              - type: weather
                entity: weather.forecast_mylocation
                show_conditions: false
                show_temperature: true
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      content:
                        type: vertical-stack
                        cards:
                          - !include ../solutions/weather_card.yaml

              - type: template
                content: >
                  {{states('sensor.processor_use') | int }}/
                  {{states('sensor.unraid1_cpu_used') | int }}
                icon: mdi:cpu-64-bit
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.navigate
                    data:
                      deviceID: THIS
                      # browser_id: THIS
                      path: /avm-mobile/server
                hold_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.sequence
                    data:
                      sequence:
                        - service: browser_mod.navigate
                          data:
                            deviceID: THIS
                            # browser_id: THIS
                            path: /avm-mobile/server
                        - service: browser_mod.close_popup


              - type: template
                entity: sensor.hotwater_soc
                content: >
                  {{states(entity) | int }}%
                icon: mdi:thermometer-water
                icon_color: >
                  {% set t=states(entity) | float(default=3) %}
                  {% if t >= 40 %}
                    white
                  {% elif t >= 20 %}
                    orange
                  {% else %}
                    red
                  {% endif %}
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      content:
                        type: vertical-stack
                        cards:
                          - !include ../cards/hotwater_card.yaml

              - type: template
                entity: sensor.gullbilen_state_of_charge
                content: >
                  {{states(entity) | float(default=61) | int }}%
                icon: mdi:car
                # icon_color: "{{ 'green' if is_state(entity, >= 50 ) else 'grey' }}"
                icon_color: >
                  {% set t=states(entity) | float(default=61) %}
                  {% if t >= 50 %}
                    white
                  {% elif t >= 35 %}
                    orange
                  {% else %}
                    red
                  {% endif %}
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      content:
                        type: vertical-stack
                        cards:
                          - !include ../cards/car_card.yaml

              - type: action
                icon: mdi:hammer
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      content:
                        type: vertical-stack
                        cards:
                          - !include ../solutions/ha_toolbox.yaml


          # # ---------   POWER !!        -----------
          - !include ../solutions/pwrctrl_use_price_card.yaml


          # # ----------  Calendar-row -----------        
          - type: vertical-stack
            cards:
              - type: custom:mushroom-template-card
                primary: Hello, {{user}}
                secondary: 7-days listing of calendar HA-shared,, click to refresh
                icon: mdi:home
                tap_action:
                  action: call-service
                  service: homeassistant.reload_config_entry
                  data: {}
                  target:
                    entity_id: calendar.ha_shared
              - type: custom:atomic-calendar-revive
                entities:
                  - entity: calendar.ha_shared
                    name: HA-shared
                firstDayOfWeek: 1
                maxDaysToShow: 7
                showWeekDay: true
                refreshInterval: 60

          # # ---------   Mental reminder, shold be in conditional with other "Alerts"        -----------
          - type: custom:mushroom-entity-card
            entity: sensor.cert_expiry_timestamp_e220_duckdns_org
            name: Certificate expiry date
          - type: custom:mushroom-entity-card
            entity: sensor.cert_expiry_timestamp_e220_duckdns_org
            name: Certificate expiry
            layout: vertical
            secondary_info: state

      - type: vertical-stack
        cards:
          # # ---------   Area-cards, swipe over two "pages"        -----------
          - type: custom:swipe-card
            parameters:
            start_card: 2
            simulateTouch: true
            spaceBetween: 8
            preventInteractionOnTransition: true
            freeMode: true
            cards:
              # Card/page1:
              # - type: vertical-stack
              #   cards:
              #     # - type: custom:mushroom-template-card
                  #   primary: Hello, {{user}}
                  #   secondary: 7-days listing of calendar HA-shared,, click to refresh
                  #   icon: mdi:home
                  #   tap_action:
                  #     action: call-service
                  #     service: homeassistant.reload_config_entry
                  #     data: {}
                  #     target:
                  #       entity_id: calendar.ha_shared
                  # - type: custom:atomic-calendar-revive
                  #   entities:
                  #     - entity: calendar.ha_shared
                  #       name: HA-shared
                  #   firstDayOfWeek: 1
                  #   maxDaysToShow: 7
                  #   showWeekDay: true
                  #   refreshInterval: 60

              # Card/page2:
              - type: grid
                columns: 3
                square: false
                cards:
                  - !include ../area/livingroom_area_card.yaml
                  - !include ../area/kitchen_area_card.yaml
                  - !include ../area/laundry_area_card.yaml
                  - !include ../area/loft_area_card.yaml
                  - !include ../area/bathroom_area_card.yaml
                  - !include ../area/hallway_area_card.yaml
                  - !include ../area/office_area_card.yaml
                  - !include ../area/serverroom_area_card.yaml

                  - !include ../area/kidl_area_card.yaml
                  - !include ../area/kidm_area_card.yaml
                  - !include ../area/kids_area_card.yaml
                  - !include ../area/bathroom2_area_card.yaml

                  - !include ../area/entry_area_card.yaml
                  - !include ../area/icehouse_area_card.yaml
                  - !include ../area/outside_area_card.yaml
                  - !include ../area/garage_area_card.yaml
                  
              # Card/page3:
              - type: grid
                columns: 2
                square: false
                cards:
                  - !include ../area/kidl_area_card.yaml
                  - !include ../area/kidm_area_card.yaml
                  - !include ../area/kids_area_card.yaml
                  - !include ../area/bathroom2_area_card.yaml
                  - !include ../area/entry_area_card.yaml
                  - !include ../area/icehouse_area_card.yaml
                  - !include ../area/outside_area_card.yaml
                  - !include ../area/garage_area_card.yaml